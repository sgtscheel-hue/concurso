<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador SEDUC Pro - v25 Estável</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; }
        .container-main { max-width: 1200px; margin: 0 auto; display: flex; gap: 20px; }
        .alternativa-card { border: 1px solid #e5e7eb; transition: 0.2s; cursor: pointer; display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 6px; background: white; margin-bottom: 4px; }
        input[type="radio"]:checked + .alternativa-card { border-color: #3b82f6; background: #eff6ff; }
        .letra-circulo { flex-shrink: 0; width: 22px; height: 22px; border: 1px solid #d1d5db; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: #6b7280; }
        input[type="radio"]:checked + .alternativa-card .letra-circulo { background: #2563eb; border-color: #2563eb; color: white; }
        .menu-item { cursor: pointer; transition: 0.2s; border-radius: 8px; padding: 10px; border-left: 4px solid transparent; font-size: 13px; }
        .menu-item.active { background: #DBEAFE; border-left-color: #2563EB; color: #1E40AF; font-weight: 700; }
        .extra-panel { display: none; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
        .bubble-ai { background: #E0F2FE; color: #0369A1; padding: 10px; border-radius: 12px 12px 12px 2px; align-self: flex-start; max-width: 85%; border-left: 3px solid #0EA5E9; font-size: 12px; }
        .bubble-user { background: #F1F5F9; color: #475569; padding: 10px; border-radius: 12px 12px 2px 12px; align-self: flex-end; max-width: 85%; font-size: 12px; }
        .tag-quest { background: #f1f5f9; color: #475569; font-size: 10px; font-weight: 700; padding: 3px 10px; border-radius: 4px; text-transform: uppercase; border: 1px solid #e2e8f0; white-space: nowrap; }
    </style>

    <script type="importmap">
    { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>

    <script src="portugues.js"></script>
    <script src="historia_geografia_rondonia.js"></script>
    <script src="conhecimentos_especificos.js"></script>
    <script src="informatica_basica.js"></script>
</head>
<body class="py-4 px-4">

    <div class="container-main">
        <div class="w-64 flex-shrink-0">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 sticky top-4">
                <h2 class="text-[10px] font-black text-gray-400 uppercase mb-2 text-center">Desempenho</h2>
                <div class="h-32 mb-4"><canvas id="performanceChart"></canvas></div>
                
                <h2 class="text-xs font-black text-gray-400 uppercase mb-2 border-t pt-4">Matérias</h2>
                <nav class="space-y-1 mb-4">
                    <div onclick="trocarMateria('todas', this)" class="menu-item">Todas as Matérias</div>
                    <div onclick="trocarMateria('portugues', this)" class="menu-item active">Português</div>
                    <div onclick="trocarMateria('rondonia', this)" class="menu-item">Hist. e Geo. RO</div>
                    <div onclick="trocarMateria('especificos', this)" class="menu-item">Conhec. Específicos</div>
                    <div onclick="trocarMateria('informatica', this)" class="menu-item">Informática</div>
                </nav>

                <h2 class="text-[10px] font-black text-gray-400 uppercase mb-2">Filtrar Assunto</h2>
                <select id="filtroAssunto" onchange="aplicarFiltro()" class="w-full text-[11px] p-2 rounded border border-gray-200 bg-gray-50 outline-none">
                    <option value="todos">Todos os assuntos</option>
                </select>

                <div class="mt-2 space-y-1">
                    <label class="flex items-center text-[10px] font-bold text-gray-500 uppercase cursor-pointer">
                        <input type="checkbox" id="checkApenasErradas" onchange="aplicarFiltro()" class="mr-2"> Apenas as que errei
                    </label>
                    <label class="flex items-center text-[10px] font-bold text-gray-500 uppercase cursor-pointer">
                        <input type="checkbox" id="checkNaoRespondidas" onchange="aplicarFiltro()" class="mr-2"> Apenas não respondidas
                    </label>
                </div>
                
                <button id="btnAulaAssunto" onclick="abrirAulaAssunto()" class="hidden w-full mt-2 bg-amber-500 hover:bg-amber-600 text-white text-[10px] font-black py-2 rounded shadow-sm transition uppercase">
                    <i class="fa-solid fa-play mr-1"></i> Assistir Aula do Assunto
                </button>
            </div>
        </div>

        <div class="flex-grow">
            <div class="flex justify-between items-center mb-3 bg-white p-3 rounded-lg shadow-sm border border-gray-200">
                <div class="flex gap-6">
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Acertos</p><p id="dashAcertos" class="text-base font-bold text-emerald-600">0</p></div>
                    <div class="text-center"><p class="text-[9px] text-gray-400 font-bold uppercase">Erros</p><p id="dashErros" class="text-base font-bold text-red-600">0</p></div>
                    <div id="nomeMateriaAtual" class="ml-4 text-xs font-bold text-blue-500 bg-blue-50 px-3 py-1 rounded-full uppercase italic">Português</div>
                </div>
                <button onclick="resetar()" class="text-gray-300 hover:text-red-500 p-2"><i class="fa-solid fa-trash-can"></i></button>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4">
                    <div id="info-questao" class="flex flex-wrap gap-2 mb-4"></div>
                    <div id="enunciado" class="text-gray-800 text-[15px] mb-4 font-medium leading-snug"></div>
                    <div id="alternativas" class="space-y-0"></div>

                    <div class="mt-4 flex items-center justify-between border-t pt-4">
                        <div class="flex gap-2">
                            <button id="btnResponder" onclick="verificar()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-2 rounded-md font-bold text-xs transition">Responder</button>
                            <button onclick="togglePanel('panel-comment')" class="bg-gray-100 text-gray-600 px-4 py-2 rounded-md font-bold text-xs hover:bg-gray-200">Comentário</button>
                            <button onclick="togglePanel('panel-video')" class="bg-red-50 text-red-600 px-4 py-2 rounded-md font-bold text-xs hover:bg-red-100">Vídeo Aula</button>
                        </div>
                        <div class="flex gap-4 items-center">
                            <button onclick="anterior()" class="text-gray-400 hover:text-blue-600 font-bold"><i class="fa-solid fa-chevron-left"></i></button>
                            <span id="posicao" class="text-[10px] text-gray-400 font-bold uppercase">0/0</span>
                            <button onclick="proxima()" class="text-gray-400 hover:text-blue-600 font-bold"><i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                    </div>

                    <div id="feedback" class="hidden mt-4 p-3 rounded-lg border-l-4"></div>
                    
                    <div id="panel-comment" class="extra-panel">
                        <h4 class="text-xs font-bold text-gray-700 mb-2">Comentário e Resumo:</h4>
                        <div id="ai-resumo" class="text-xs text-gray-600 leading-relaxed bg-gray-50 p-3 rounded-lg border"></div>
                    </div>

                    <div id="panel-video" class="extra-panel">
                        <div id="video-container" class="aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center text-white text-xs">
                            <p><i class="fa-brands fa-youtube text-red-600 text-2xl mr-2"></i> Selecione uma aula</p>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-sky-50 p-4 rounded-xl border border-sky-100">
                        <h4 class="text-[10px] font-black text-sky-700 uppercase mb-2"><i class="fa-solid fa-robot mr-1"></i> Gemini AI Professor</h4>
                        <div id="chatWindow" class="flex flex-col gap-2 max-h-48 overflow-y-auto mb-3 bg-white/50 p-2 rounded-lg">
                            <div class="bubble-ai">Posso explicar qualquer alternativa desta questão. O que você quer saber?</div>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="geminiInput" placeholder="Sua dúvida..." class="flex-grow text-xs p-2 rounded-md border border-sky-200 outline-none">
                            <button onclick="perguntarGemini()" class="bg-sky-600 text-white px-4 py-2 rounded-md text-xs font-bold"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalAulas" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-amber-500 p-4 flex justify-between items-center text-white">
                <h3 class="font-bold text-sm uppercase"><i class="fa-solid fa-layer-group mr-2"></i> Escolha a Vídeo Aula</h3>
                <button onclick="fecharModalAulas()" class="hover:text-amber-200"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div id="listaAulas" class="p-4 space-y-2 max-h-80 overflow-y-auto"></div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";
        const API_KEY = "AIzaSyCh78zQXbJ7F4IOniMNBJXxa3dfqv93BJE";
        const genAI = new GoogleGenerativeAI(API_KEY);

        window.perguntarGemini = async function() {
            const input = document.getElementById('geminiInput');
            const chat = document.getElementById('chatWindow');
            const pergunta = input.value.trim();
            if(!pergunta) return;

            chat.innerHTML += `<div class="bubble-user">${pergunta}</div>`;
            input.value = "";
            const loading = document.createElement("div");
            loading.className = "bubble-ai italic text-gray-400";
            loading.innerText = "O Professor está analisando...";
            chat.appendChild(loading);
            chat.scrollTop = chat.scrollHeight;

            try {
                const q = window.questoesFiltradas[window.index];
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const context = `Você é um Professor de Concursos. Matéria: ${window.materiaAtual}. Questão: ${q.enunciado}. Gabarito: ${q.correta}. Dúvida: ${pergunta}`;
                const result = await model.generateContent(context);
                const response = await result.response;
                loading.innerText = response.text();
                loading.classList.remove("italic", "text-gray-400");
            } catch (e) {
                loading.innerText = "Erro ao conectar com a IA.";
                loading.classList.add("text-red-500");
            }
            chat.scrollTop = chat.scrollHeight;
        }
    </script>

    <script>
        // 1. Configurações Iniciais
        const aulasPorAssunto = {
            'portugues': {
                'Verbos': [
                    { titulo: 'Aula 01: Tudo sobre Verbos', url: 'https://www.youtube.com/embed/_G8y60xyXpU?si=rFGeC6XTIkWdZ15l' },
                    { titulo: 'Aula 02: Verbo Haver', url: 'https://www.youtube.com/embed/Rgfb9KAYbLs?si=4NcFFaWrby43yTHy' },
                    { titulo: 'Aula 02: Vozes Verbais', url: 'https://www.youtube.com/embed/NgR2w2v3lDg?si=DjiE-efgSK9_jVJu' },
                    { titulo: 'Aula 02: Correlação Verbal', url: 'https://www.youtube.com/embed/mncbUqIW5JI?si=JdB2ugXOMS1zPnsJ' }
                ],
                'Ortografia Oficial': [
                    { titulo: 'Aula 01: Ortografia Oficial', url: 'https://www.youtube.com/embed/xD5NDLCUhaU?si=DqhQFLYJnZo5rHPX' }
                ],
                'Formação das Palavras': [
                    { titulo: 'Aula 01: Processso de Formação das Palavras', url: 'https://www.youtube.com/embed/Xw74aXTBaoY?si=28SAVGVF8NGmIwoo' }
                ],
                'Acentuação Gráfica': [
                    { titulo: 'Aula 01: Regras Gerais', url: 'https://www.youtube.com/embed/nWQVPQmxWTk?si=yGR4H6DJHDrLRWXn' },
                    { titulo: 'Aula 02: Exercícios Comentados', url: 'https://www.youtube.com/embed/URL_2' }
                ],
                'Classes de Palavras': [
                    { titulo: 'Classe das Palavras', url: 'https://www.youtube.com/embed/ltrzPijgKi4?si=eYAIPdDj4ryAfIBm' },
                    { titulo: 'Conjunções', url: 'https://www.youtube.com/embed/tKJkDQSMdh0?si=KCbnoh96kIYpY0OE' }
                ]
            },
            'rondonia': {
                'História de Rondônia': [
                    { titulo: 'Ciclo da Borracha', url: 'https://www.youtube.com/embed/URL_4' },
                    { titulo: 'Criação do Estado', url: 'https://www.youtube.com/embed/URL_5' }
                ]

            }
        };

        window.materiaAtual = 'portugues';
        window.index = 0;
        window.questoesFiltradas = [];
        let respondidaNaSessao = false;
        let myChart = null;

        // 2. Inicializar Bibliotecas
        function atualizarBibliotecas() {
            window.bibliotecas = {
                'portugues': typeof banco_pt !== 'undefined' ? banco_pt : [],
                'rondonia': typeof banco_ro !== 'undefined' ? banco_ro : [],
                'especificos': typeof banco_esp !== 'undefined' ? banco_esp : [],
                'informatica': typeof banco_inf !== 'undefined' ? banco_inf : []
            };
        }

        // 3. Funções de Controle de Interface
        function trocarMateria(materia, element) {
            window.materiaAtual = materia;
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
            document.getElementById('nomeMateriaAtual').innerText = element.innerText;
            
            popularFiltros();
            aplicarFiltro();
        }

        function popularFiltros() {
            const select = document.getElementById('filtroAssunto');
            if (window.materiaAtual === 'todas') {
                select.innerHTML = '<option value="todos">Selecione uma matéria específica</option>';
                select.disabled = true;
                return;
            }
            select.disabled = false;
            const banco = window.bibliotecas[window.materiaAtual] || [];
            const assuntos = [...new Set(banco.map(q => q.assunto).filter(Boolean))];
            select.innerHTML = `<option value="todos">Todos os assuntos</option>` + 
                              assuntos.map(a => `<option value="${a}">${a}</option>`).join('');
            select.value = "todos";
        }

        function aplicarFiltro() {
            const filtroAssunto = document.getElementById('filtroAssunto').value;
            const apenasErradas = document.getElementById('checkApenasErradas').checked;
            const apenasNaoRespondidas = document.getElementById('checkNaoRespondidas').checked;
            const respondidasMap = JSON.parse(localStorage.getItem('seduc_respondidas_map')) || {};

            let resultado = (window.materiaAtual === 'todas') 
                ? Object.values(window.bibliotecas).flat() 
                : [...(window.bibliotecas[window.materiaAtual] || [])];

            if (filtroAssunto !== 'todos') {
                resultado = resultado.filter(q => q.assunto === filtroAssunto);
            }
            if (apenasErradas) resultado = resultado.filter(q => respondidasMap[q.id] === 'erro');
            if (apenasNaoRespondidas) resultado = resultado.filter(q => !respondidasMap[q.id]);

            window.questoesFiltradas = resultado;
            window.index = 0;
            render();
        }

        // 4. Funções de Renderização (VERSÃO COM CORES E NOVAS TAGS)
function render() {
    const q = window.questoesFiltradas[window.index];
    const feedback = document.getElementById('feedback');
    const btnResp = document.getElementById('btnResponder');
    
    feedback.classList.add('hidden');
    document.getElementById('panel-comment').style.display = 'none';
    document.getElementById('panel-video').style.display = 'none';

    if (!q) {
        document.getElementById('enunciado').innerText = "Nenhuma questão encontrada para este filtro.";
        document.getElementById('alternativas').innerHTML = "";
        document.getElementById('posicao').innerText = "0/0";
        document.getElementById('info-questao').innerHTML = "";
        return;
    }

    respondidaNaSessao = false;
    btnResp.disabled = false;
    btnResp.classList.remove('opacity-50');

    // CABEÇALHO COLORIDO E COMPLETO
    document.getElementById('info-questao').innerHTML = `
        <span class="tag-quest bg-blue-600 text-white border-none">${q.materia || 'Matéria'}</span>
        <span class="tag-quest bg-emerald-100 text-emerald-700 border-emerald-200 font-bold">${q.orgao || 'Órgão'}</span>
        <span class="tag-quest bg-amber-50 text-amber-700 border-amber-200">${q.banca || 'Banca'}</span>
        <span class="tag-quest bg-gray-100 text-gray-600">${q.ano || 'Ano'}</span>
        <span class="tag-quest text-blue-600 font-black border-blue-100 uppercase text-[9px]">${q.assunto || 'Assunto'}</span>
        <span class="tag-quest italic text-gray-400 border-none">Prova: ${q.prova || 'Geral'}</span>
    `;
    
    document.getElementById('enunciado').innerHTML = q.enunciado;
    document.getElementById('posicao').innerText = `${window.index + 1} / ${window.questoesFiltradas.length}`;
    document.getElementById('ai-resumo').innerHTML = q.comentario || 'Sem comentário.';

    document.getElementById('alternativas').innerHTML = ['a','b','c','d','e'].map(l => 
        q[l] ? `<label class="block">
                    <input type="radio" name="quiz" value="${l}" class="hidden">
                    <div class="alternativa-card">
                        <span class="letra-circulo uppercase">${l}</span>
                        <div class="text-gray-700 text-[13px]">${q[l]}</div>
                    </div>
                </label>` : ''
    ).join('');
    
    const filtro = document.getElementById('filtroAssunto').value;
    const temAula = aulasPorAssunto[window.materiaAtual]?.[filtro];
    document.getElementById('btnAulaAssunto').classList.toggle('hidden', !temAula);
    
    updateDash();
}

        function verificar() {
            const q = window.questoesFiltradas[window.index];
            const sel = document.querySelector('input[name="quiz"]:checked');
            if (!sel || respondidaNaSessao) return;

            respondidaNaSessao = true;
            document.getElementById('btnResponder').disabled = true;
            document.getElementById('btnResponder').classList.add('opacity-50');

            const f = document.getElementById('feedback');
            f.classList.remove('hidden');
            
            let map = JSON.parse(localStorage.getItem('seduc_respondidas_map')) || {};
            if (sel.value === q.correta.toLowerCase()) {
                f.className = "mt-4 p-3 rounded-lg border-l-4 bg-emerald-50 border-emerald-500 text-emerald-800 text-xs";
                f.innerHTML = "<strong>✓ Correto!</strong>";
                map[q.id] = 'acerto';
            } else {
                f.className = "mt-4 p-3 rounded-lg border-l-4 bg-red-50 border-red-500 text-red-800 text-xs";
                f.innerHTML = "<strong>✕ Errado.</strong> Gabarito: " + q.correta.toUpperCase();
                map[q.id] = 'erro';
            }

            localStorage.setItem('seduc_respondidas_map', JSON.stringify(map));
            const vals = Object.values(map);
            localStorage.setItem('seduc_acertos', vals.filter(v => v === 'acerto').length);
            localStorage.setItem('seduc_erros', vals.filter(v => v === 'erro').length);
            updateDash();
        }

        function updateDash() {
            const acertos = parseInt(localStorage.getItem('seduc_acertos')) || 0;
            const erros = parseInt(localStorage.getItem('seduc_erros')) || 0;
            document.getElementById('dashAcertos').innerText = acertos;
            document.getElementById('dashErros').innerText = erros;
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: (acertos + erros === 0) ? [1, 0] : [acertos, erros],
                        backgroundColor: (acertos + erros === 0) ? ['#E5E7EB'] : ['#10B981', '#EF4444'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '75%', plugins: { legend: { display: false } } }
            });
        }

        // Funções de Navegação e Utilitários
        function proxima() { if(window.index < window.questoesFiltradas.length - 1) { window.index++; render(); } }
        function anterior() { if(window.index > 0) { window.index--; render(); } }
        function togglePanel(id) { const p = document.getElementById(id); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }
        function resetar() { if(confirm("Deseja zerar seu progresso?")) { localStorage.clear(); location.reload(); } }
        function fecharModalAulas() { document.getElementById('modalAulas').classList.add('hidden'); }
        
        function abrirAulaAssunto() {
            const filtro = document.getElementById('filtroAssunto').value;
            const aulas = aulasPorAssunto[window.materiaAtual]?.[filtro];
            if (aulas) {
                const lista = document.getElementById('listaAulas');
                lista.innerHTML = aulas.map((a, i) => `
                    <button onclick="carregarVideo('${a.url}')" class="w-full text-left p-3 bg-gray-50 rounded-lg hover:bg-amber-50 text-xs font-bold border mb-2">
                        ${i+1}. ${a.titulo}
                    </button>`).join('');
                document.getElementById('modalAulas').classList.remove('hidden');
            }
        }

        function carregarVideo(url) {
            document.getElementById('panel-video').style.display = 'block';
            document.getElementById('video-container').innerHTML = `<iframe width="100%" height="100%" src="${url}" frameborder="0" allowfullscreen></iframe>`;
            fecharModalAulas();
        }

        window.onload = () => {
            atualizarBibliotecas();
            popularFiltros();
            aplicarFiltro();
            updateDash();
        };
    </script>
</body>
</html>


